import{capitalizeFirstLetter}from"./helpers.js";import{courseContent}from"./course-content.js";const groupSelect=document.getElementById("group"),track=document.getElementById("track"),startDate=document.getElementById("start-date"),endDate=document.getElementById("end-date");async function getGroupTrack(e){const t=await fetch(`functions/Lectures/get_group_track.php?group_id=${e}`),n=await t.json();if(n.empty&&(track.value=""),n.data){document.querySelector(`#track option[value="${n.data.track_id}"]`).selected=!0,track.value=n.data.track_id;const e=new Event("change",{bubbles:!0});track.dispatchEvent(e)}}async function getGroupInfo(e){const t=await fetch(`functions/Groups/get_group.php?group_id=${e}`),n=await t.json();n.data&&(startDate.innerText=n.data.formatted_date,endDate.innerText="End : "+n.data.group_end_date)}function populateLectures(e){const t=document.getElementById("comment-input");window.slimSelect&&window.slimSelect.destroy(),t.innerHTML=e?'<option value="">Search for Lectures</option>':'<option value="">Select Track First</option>';const n=courseContent.find((t=>t.track==={1:"HTML",2:"CSS",3:"JavaScript",4:"PHP",5:"database",6:"Project"}[e]));if(!n)return;const a=Object.keys(n.lectures);if(1===a.length){n.lectures[a[0]].forEach(((e,n)=>{const a=document.createElement("option");a.value=e,a.textContent=e,t.appendChild(a)}))}else a.forEach((e=>{const a=document.createElement("optgroup");a.label=e,n.lectures[e].forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,a.appendChild(t)})),t.appendChild(a)}));window.slimSelect=new SlimSelect({select:"#comment-input",settings:{placeholderText:"Search for Lectures",allowDeselect:!0,closeOnSelect:!0,showSearch:!1,searchPlaceholder:"Search Lectures...",searchText:"No Results",searchHighlight:!0},events:{beforeOpen:()=>{document.body.style.overflow="auto"},beforeClose:()=>{document.body.style.overflow=""}}})}document.addEventListener("DOMContentLoaded",(()=>{fetch("functions/Groups/get_groups.php").then((e=>e.json())).then((e=>{[...new Set(e.data.map((e=>e.branch_name)))].forEach((t=>{const n=document.createElement("optgroup");n.className="capitalize text-base font-normal",n.label=t,e.data&&(e.data.forEach((a=>{if(e.isMultiBranch){const e=document.createElement("option");a.branch_name==t&&(e.value=a.id,e.textContent=capitalizeFirstLetter(a.name),n.append(e),a.name.toLowerCase().includes("training")||groupSelect.append(n))}else{const e=document.createElement("option");e.value=a.id,e.textContent=capitalizeFirstLetter(a.name),a.name.toLowerCase().includes("training")||groupSelect.append(e)}})),document.getElementById("preload").classList.add("hidden"))}))})).catch((e=>console.error("Error fetching groups:",e))),fetch("functions/Tracks/get_tracks.php").then((e=>e.json())).then((e=>{track.innerHTML='<option value="">Select Track</option>',e.data&&e.data.forEach((e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name.toUpperCase(),track.appendChild(t)}))})).catch((e=>console.error("Error fetching groups:",e)))})),track.addEventListener("change",(function(){populateLectures(this.value)})),groupSelect.oninput=async function(){const e=this.value;if(!e)return track.value="",startDate.innerText="Group Start Date",endDate.innerText="Excpected End Date",void populateLectures(null);try{await getGroupTrack(e),await getGroupInfo(e)}catch(e){console.error("Error fetching tracks:",e)}};