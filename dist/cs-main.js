const searchInput=document.getElementById("table-search"),tbody=document.querySelector("tbody"),addInstructor=document.getElementById("addInstructor");function setTable(e){if(tbody.innerHTML="",0==e.data.length&&(tbody.innerHTML='\n        <tr>\n          <td class="px-6 py-4 font-bold" colspan="4"> No Customer Service Agent Found </td>\n        </tr>\n    '),"success"===e.status){const t=e.logged_instructor_role;e.data.forEach(e=>{const n=document.createElement("tr"),s=(e.role===t||e.role,"cs-admin"==e.role?' <i class="fa-solid fa-user-shield ml-3 text-green-700"></i>':"");n.className="odd:bg-white even:bg-gray-50 bg-white border-b border-gray-200 hover:bg-gray-50";const r=e.is_active?"Active":"Disabled",o=e.is_active?" bg-green-50  text-green-700 ring-green-600/20 ":" bg-red-50 text-red-700 ring-red-600/10 ";e.is_active,e.is_active,e.is_active;n.innerHTML=`\n                <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">\n                    ${capitalizeFirstLetter(e.username)}\n                    ${s}\n                </th>\n                <td class="w-40 px-6 py-4">\n                  <div class="w-fit text-white bg-sky-700 hover:bg-sky-800 focus:ring-4 focus:outline-none focus:ring-sky-300 font-medium rounded text-sm py-1 px-2 text-center">\n                    <a class="flex" id="add-salary" href="?action=add&id=${e.id}">\n                      <i class="fa-solid fa-money-check-dollar mr-2 text-sm"></i>\n                      <span class="hidden md:inline-block mr-1">Edit </span>\n                      salary\n                    </a>\n                  </div>\n                </td>\n                \n                <td scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">\n                    ${e.email||'<span class="text-gray-400">Not Assigned</span>'}\n                </td>\n                <td class="px-6 py-4">\n                <div class="flex flex-row justify-start items-center">\n                <svg class=" w-5 h-5 mr-1.5 text-indigo-500 md:inline " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">\n                                <path fill-rule="evenodd" d="M12 2c-.791 0-1.55.314-2.11.874l-.893.893a.985.985 0 0 1-.696.288H7.04A2.984 2.984 0 0 0 4.055 7.04v1.262a.986.986 0 0 1-.288.696l-.893.893a2.984 2.984 0 0 0 0 4.22l.893.893a.985.985 0 0 1 .288.696v1.262a2.984 2.984 0 0 0 2.984 2.984h1.262c.261 0 .512.104.696.288l.893.893a2.984 2.984 0 0 0 4.22 0l.893-.893a.985.985 0 0 1 .696-.288h1.262a2.984 2.984 0 0 0 2.984-2.984V15.7c0-.261.104-.512.288-.696l.893-.893a2.984 2.984 0 0 0 0-4.22l-.893-.893a.985.985 0 0 1-.288-.696V7.04a2.984 2.984 0 0 0-2.984-2.984h-1.262a.985.985 0 0 1-.696-.288l-.893-.893A2.984 2.984 0 0 0 12 2Zm3.683 7.73a1 1 0 1 0-1.414-1.413l-4.253 4.253-1.277-1.277a1 1 0 0 0-1.415 1.414l1.985 1.984a1 1 0 0 0 1.414 0l4.96-4.96Z" clip-rule="evenodd" />\n                            </svg>\n                    ${e.branch_names?capitalizeFirstLetter(e.branch_names):"Not Assigned"}\n                    </div>\n                </td>\n                <td class="px-6 py-4">\n                    <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset  ${o}">\n                        ${r}\n                    </span>\n                </td>\n\n                ${generateActionCell(e,t)}\n                \n            `,tbody.appendChild(n)})}}function generateActionCell(e,t){const n=e.role===t||"owner"===e.role?"disabled":"",s=e.is_active?"Disable":"Enable",r=e.is_active?"text-red-600":"text-green-600",o=e.is_active?'<i class="fa-solid fa-user-slash hidden md:inline-block mr-1 text-sm"></i>':'<i class="fa-solid fa-user hidden md:inline-block mr-1 text-sm"></i>',a="owner"===e.role?"pointer-events-none text-gray-500 cursor-not-allowed":"text-blue-600";return`\n    <td class="px-6 py-4 flex flex-col md:flex-row gap-1 w-fit">\n      <a href="?action=edit&instructor_id=${e.id}"\n         class="cursor-pointer border border-gray-300 py-0.5 px-2 rounded-lg font-medium ${a} hover:underline text-center w-full md:w-fit flex items-center">\n        <i class="fa-solid fa-pen-to-square mr-1 hidden md:inline-block text-sm"></i>\n        Edit\n      </a>\n\n      <button ${n}\n        class="w-full md:w-fit toggle-status-btn cursor-pointer text-sm border border-gray-300 py-1 px-2 rounded-lg ${r} hover:underline\n               disabled:border-gray-200 disabled:bg-gray-50 disabled:text-gray-500 disabled:shadow-none disabled:cursor-not-allowed disabled:hover:no-underline"\n        data-agent-id="${e.id}">\n        ${o}\n        ${s}\n      </button>\n\n      <button ${n}\n        class="delete-cs-btn w-full md:w-fit cursor-pointer text-sm border border-gray-300 py-1 px-2 rounded-lg text-red-600 hover:underline \n               disabled:border-gray-200 disabled:bg-gray-50 disabled:text-gray-500 disabled:shadow-none disabled:cursor-not-allowed disabled:hover:no-underline"\n        data-agent-id="${e.id}">\n        <i class="fa-solid fa-trash mr-1 hidden md:inline-block text-sm"></i>\n        Delete\n      </button>\n    </td>\n  `}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function updateInstructorStatusUI(e,t){const n=t?"Disabled":"Active",s=t?"bg-red-50 text-red-700 ring-red-600/10":"bg-green-50 text-green-700 ring-green-600/20",r=t?"Enable":"Disable",o=t?"text-green-500":"text-red-500",a=t?'<i class="fa-solid fa-user mr-1"></i>':'<i class="fa-solid fa-user-slash mr-1"></i>',i=e.closest("tr").querySelector("td span");i.textContent=n,i.className=`inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ${s}`,e.innerHTML=`${a} ${r}`,e.className=`toggle-status-btn cursor-pointer text-sm font-medium border border-gray-300 py-1 px-2 rounded-lg ${o} hover:underline`}function debounce(e,t){let n;return function(...s){clearTimeout(n),n=setTimeout(()=>{e.apply(this,s)},t)}}document.addEventListener("DOMContentLoaded",function(){const e=debounce(function(){!function(e){const t=e.trim();fetch(`functions/Customer-service/search_cs.php?search=${encodeURIComponent(t)}`).then(e=>e.json()).then(e=>{setTable(e)}).catch(e=>console.error("Error:",e))}(this.value)},500);searchInput.addEventListener("input",e),tbody.addEventListener("click",function(e){if(e.target.closest(".toggle-status-btn")){const t=e.target.closest(".toggle-status-btn"),n=t.dataset.agentId,s="Disable"===t.textContent.trim();confirm(s?"Are you sure you want to disable this CS Agent?":"Are you sure you want to enable this CS Agent?")&&fetch("functions/Customer-service/toggle_cs_status.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`cs_id=${n}`}).then(e=>e.json()).then(e=>{"success"===e.status?(notyf.success("Customer service agent Update successfully"),updateInstructorStatusUI(t,s)):alert("Error updating Customer service status")}).catch(e=>{console.error("Error:",e),alert("Error updating Customer service status")})}if(e.target.closest(".delete-cs-btn")){const t=e.target.closest(".delete-cs-btn"),n=t.dataset.agentId;confirm("Are you sure you want to delete this CS Agent? This action cannot be undone.")&&fetch("functions/Customer-service/delete_cs.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`cs_id=${n}`}).then(e=>e.json()).then(e=>{"success"===e.status?(notyf.success("Customer service agent deleted successfully"),t.closest("tr").remove()):notyf.error(e.message||"Error deleting Customer service agent")}).catch(e=>{console.error("Error:",e),notyf.error("Error deleting Customer service agent")})}})}),addInstructor.onclick=function(){fetch("functions/Branches/get_branches.php").then(e=>e.json()).then(e=>{"success"==e.status&&(branchesSelect.innerHTML='<option value="" selected>Choose a Branch</option>',e.data.forEach(e=>{let t=document.createElement("option");t.value=e.id,t.textContent=capitalizeFirstLetter(e.name),branchesSelect.appendChild(t)}))}).catch(e=>console.error("Error fetching lectures:",e))};