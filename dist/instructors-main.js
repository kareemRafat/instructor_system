import{capitalizeFirstLetter}from"./helpers.js";const searchInput=document.getElementById("table-search"),tbody=document.querySelector("tbody"),addInstructor=document.getElementById("addInstructor");function setTable(t){tbody.innerHTML="",0==t.data.length&&(tbody.innerHTML='\n        <tr>\n          <td class="px-6 py-4 font-bold" colspan="4"> No Instructor Found </td>\n        </tr>\n    '),"success"===t.status&&t.data.forEach((t=>{const e=document.createElement("tr");e.className="odd:bg-white even:bg-gray-50 bg-white border-b border-gray-200 hover:bg-gray-50";const n=t.is_active?"Active":"Disabled",r=t.is_active?" bg-green-50  text-green-700 ring-green-600/20 ":" bg-red-50 text-red-700 ring-red-600/10 ",s=t.is_active?"Disable":"Enable",a=t.is_active?"text-red-500":"text-green-500",o=t.is_active?'<i class="fa-solid fa-user-slash mr-1"></i>':'<i class="fa-solid fa-user mr-1"></i>';e.innerHTML=`\n                <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">\n                    ${capitalizeFirstLetter(t.username)}\n                </th>\n                <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">\n                    ${capitalizeFirstLetter(t.email||'<span class="text-gray-400">Not Assigned</span>')}\n                </th>\n                <td class="px-6 py-4">\n                <div class="flex flex-row justify-start items-center gap-1">\n                  <svg class=" w-5 h-5 text-indigo-600  md:inline " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">\n                                        <path fill-rule="evenodd" d="M12 2c-.791 0-1.55.314-2.11.874l-.893.893a.985.985 0 0 1-.696.288H7.04A2.984 2.984 0 0 0 4.055 7.04v1.262a.986.986 0 0 1-.288.696l-.893.893a2.984 2.984 0 0 0 0 4.22l.893.893a.985.985 0 0 1 .288.696v1.262a2.984 2.984 0 0 0 2.984 2.984h1.262c.261 0 .512.104.696.288l.893.893a2.984 2.984 0 0 0 4.22 0l.893-.893a.985.985 0 0 1 .696-.288h1.262a2.984 2.984 0 0 0 2.984-2.984V15.7c0-.261.104-.512.288-.696l.893-.893a2.984 2.984 0 0 0 0-4.22l-.893-.893a.985.985 0 0 1-.288-.696V7.04a2.984 2.984 0 0 0-2.984-2.984h-1.262a.985.985 0 0 1-.696-.288l-.893-.893A2.984 2.984 0 0 0 12 2Zm3.683 7.73a1 1 0 1 0-1.414-1.413l-4.253 4.253-1.277-1.277a1 1 0 0 0-1.415 1.414l1.985 1.984a1 1 0 0 0 1.414 0l4.96-4.96Z" clip-rule="evenodd"></path>\n                                        </svg>\n                \n                    ${t.branch_names?capitalizeFirstLetter(t.branch_names):"Not Assigned"}\n                </td>\n                </div>\n                <td class="px-6 py-4">\n                    <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset  ${r}">\n                        ${n}\n                    </span>\n                </td>\n                <td class="px-6 py-4">\n                    <button class="toggle-status-btn cursor-pointer text-sm border border-gray-300 py-1 px-2 rounded-lg hover:underline ${a}" data-instructor-id="${t.id}">\n                        ${o}\n                        ${s}\n                    </button>\n                </td>\n            `,tbody.appendChild(e)}))}function updateInstructorStatusUI(t,e){const n=e?"Disabled":"Active",r=e?"bg-red-50 text-red-700 ring-red-600/10":"bg-green-50 text-green-700 ring-green-600/20",s=e?"Enable":"Disable",a=e?"text-green-500":"text-red-500",o=e?'<i class="fa-solid fa-user mr-1"></i>':'<i class="fa-solid fa-user-slash mr-1"></i>',c=t.closest("tr").querySelector("td .isactive-span");c.textContent=n,c.className=`isactive-span inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ${r}`,t.innerHTML=`${o} ${s}`,t.className=`toggle-status-btn cursor-pointer text-sm font-medium border border-gray-300 py-1 px-2 rounded-lg ${a} hover:underline`}document.addEventListener("DOMContentLoaded",(function(){searchInput.addEventListener("input",(function(){const t=this.value.trim();fetch(`functions/Instructors/search_instructors.php?search=${encodeURIComponent(t)}`).then((t=>t.json())).then((t=>{setTable(t)})).catch((t=>console.error("Error:",t)))})),tbody.addEventListener("click",(function(t){if(t.target.closest(".toggle-status-btn")){const e=t.target.closest(".toggle-status-btn"),n=e.dataset.instructorId,r="Disable"===e.textContent.trim();confirm(r?"Are you sure you want to disable this instructor?":"Are you sure you want to enable this instructor?")&&fetch("functions/Instructors/toggle_instructor_status.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`instructor_id=${n}`}).then((t=>t.json())).then((t=>{"success"===t.status?(notyf.success("Instructor Updated successfully"),updateInstructorStatusUI(e,r)):alert("Error updating instructor status")})).catch((t=>{console.error("Error:",t),alert("Error updating instructor status")}))}}))})),addInstructor.onclick=function(){fetch("functions/Branches/get_branches.php").then((t=>t.json())).then((t=>{if("success"===t.status){const e=document.getElementById("branchesContainer");e.innerHTML="",t.data.forEach(((n,r)=>{const s=document.createElement("label");r===t.data.length-1?s.className="col-span-2 md:col-span-1 flex items-center space-x-2 bg-gray-50 border border-gray-300 rounded-lg px-4 py-2 cursor-pointer hover:bg-gray-100":s.className="col-span-1 flex items-center space-x-2 bg-gray-50 border border-gray-300 rounded-lg px-4 py-2 cursor-pointer hover:bg-gray-100";const a=document.createElement("input");a.type="checkbox",a.name="branch_ids[]",a.value=n.id,a.className="text-blue-600 focus:ring-blue-500 border-gray-300 rounded border";const o=document.createElement("span");o.className="text-gray-900 text-sm",o.textContent=capitalizeFirstLetter(n.name),s.appendChild(a),s.appendChild(o),e.appendChild(s)}))}})).catch((t=>console.error("Error fetching branches:",t)))};