import{capitalizeFirstLetter,getQueryString,globalWait}from"./helpers.js";const tbody=document.querySelector("tbody"),page=getQueryString("page"),branchVal=getQueryString("branch"),pageList=document.getElementById("page-list"),instructorSelect=document.getElementById("instructor-select"),branchSelect=document.getElementById("branchSelect");function setTable(t,e=null){tbody.innerHTML="",0==t.data.length&&(tbody.innerHTML='\n        <tr>\n          <td class="px-6 py-3.5 font-bold bg-white" colspan="9"> No Group Found </td>\n        </tr>\n    '),t.data.forEach((t=>{let e=null;e=t.has_bonus?'<i class="fa-solid fa-square-check text-green-600 mr-2"></i> <span class="text-green-600">Has Bonus':'<i class="fa-solid fa-square-xmark text-red-600 mr-2"></i> No Bonus Granted';const n=document.createElement("tr");n.className="bg-white border-b border-gray-200 hover:bg-gray-50",n.innerHTML=`\n      <th scope="row" class="px-4 py-3.5 font-medium text-gray-900 whitespace-nowrap">\n          ${t.group_name.charAt(0).toUpperCase()+t.group_name.slice(1)}\n      </th>\n      <th scope="row" class="px-4 py-3.5 font-medium text-pink-900 whitespace-nowrap">\n      <i class="fa-solid fa-clock mr-1.5"></i>\n          ${2==t.group_time||5==t.group_time?`${t.group_time} - Friday`:t.group_time}\n      </th>\n      <th scope="row" class="px-4 py-3.5 font-medium text-gray-900 whitespace-nowrap">\n      <span class="${dayBadgeColor(t.group_day)} text-sm font-medium me-2 px-2.5 py-1.5 rounded-md">${t.group_day}</span></th>\n      <td class="px-4 py-3.5 text-sky-600 capitalize">\n        ${capitalizeFirstLetter(t.track)}\n      </td>\n      <td class="px-4 py-3.5">\n      <span class="w-2 h-2 ${branchIndicator(t.branch_name).bgColor} inline-block mr-2"></span>\n          ${t.instructor_name.charAt(0).toUpperCase()+t.instructor_name.slice(1)}\n      </td>\n      <td class="px-4 py-3.5 ${branchIndicator(t.branch_name).textColor}">\n        <div class="flex flex-row justify-start items-center">\n          <svg class=" w-5 h-5 mr-1.5  md:inline " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">\n              <path fill-rule="evenodd" d="M12 2c-.791 0-1.55.314-2.11.874l-.893.893a.985.985 0 0 1-.696.288H7.04A2.984 2.984 0 0 0 4.055 7.04v1.262a.986.986 0 0 1-.288.696l-.893.893a2.984 2.984 0 0 0 0 4.22l.893.893a.985.985 0 0 1 .288.696v1.262a2.984 2.984 0 0 0 2.984 2.984h1.262c.261 0 .512.104.696.288l.893.893a2.984 2.984 0 0 0 4.22 0l.893-.893a.985.985 0 0 1 .696-.288h1.262a2.984 2.984 0 0 0 2.984-2.984V15.7c0-.261.104-.512.288-.696l.893-.893a2.984 2.984 0 0 0 0-4.22l-.893-.893a.985.985 0 0 1-.288-.696V7.04a2.984 2.984 0 0 0-2.984-2.984h-1.262a.985.985 0 0 1-.696-.288l-.893-.893A2.984 2.984 0 0 0 12 2Zm3.683 7.73a1 1 0 1 0-1.414-1.413l-4.253 4.253-1.277-1.277a1 1 0 0 0-1.415 1.414l1.985 1.984a1 1 0 0 0 1.414 0l4.96-4.96Z" clip-rule="evenodd" />\n          </svg>\n          ${t.branch_name.charAt(0).toUpperCase()+t.branch_name.slice(1)}\n        </div>\n      </td> \n      <td class="px-4 py-3.5">\n          <span class="block text-rose-700">${t.month}</span>\n          ${t.formatted_date?t.formatted_date:"No date added"}\n      </td>     \n      <td class="px-4 py-3.5">\n          <span class="text-purple-700">${t.group_end_month}</span>\n          <br>\n          ${t.group_end_date}\n      </td>      \n      <td class="px-4 py-3.5">\n          ${e}\n      </td>\n  `,tbody.appendChild(n)}))}async function fetchInstructors(t){try{const e=await fetch(`functions/Instructors/get_instructors.php?branch_id=${t}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=await e.json();instructorSelect.innerHTML=t?"<option value=''>Choose Instructor</option>":"<option value=''>Select Branch First</option>",n.data&&n.data.forEach((t=>{const e=document.createElement("option");e.value=t.id,e.textContent=capitalizeFirstLetter(t.username),instructorSelect.appendChild(e)}))}catch(t){console.error("Error fetching instructors:",t),instructorSelect.innerHTML="<option value=''>Error loading instructors</option>"}}function branchIndicator(t){const e={tanta:"bg-teal-600",mansoura:"bg-blue-600",zagazig:"bg-purple-500",default:"bg-orange-600"},n={tanta:"text-teal-600",mansoura:"text-blue-700",zagazig:"text-purple-700",default:"text-orange-700"};return{bgColor:e[t=t.toLowerCase()]||e.default,textColor:n[t]||n.default}}function dayBadgeColor(t){const e={saturday:"bg-orange-100 text-orange-600 border border-orange-300",sunday:"bg-blue-100 text-blue-700 border border-blue-300",monday:"bg-pink-100 text-pink-700 border border-pink-300",default:"bg-zinc-100 text-zinc-700 border border-zinc-300"};return e[t=t.toLowerCase()]||e.default}document.addEventListener("DOMContentLoaded",(function(){fetch("functions/Branches/get_branches.php").then((t=>t.json())).then((t=>{"success"==t.status&&(branchSelect.innerHTML='<option value="" selected>Select a Branch</option>',t.data.forEach((t=>{let e=document.createElement("option");e.value=t.id,e.textContent=capitalizeFirstLetter(t.name),e.value==branchVal&&(e.selected=!0),branchSelect.appendChild(e)})))})).catch((t=>console.error("Error fetching lectures:",t))),fetchInstructors(branchVal),instructorSelect.addEventListener("change",(function(t){const e=this.value;this.selectedOptions[0];let n="";n=e?`functions/Groups/get_finished_groups.php?instructor_id=${encodeURIComponent(e)}&branch_id=${branchVal}`:`functions/Groups/get_finished_groups.php?branch_id=${branchVal}`,fetch(n).then((t=>t.json())).then((t=>{setTable(t)})).catch((t=>console.error("Error:",t)))})),branchSelect.addEventListener("change",(t=>{const e=t.target.value,n=new URL(window.location);n.searchParams.delete("page"),e?n.searchParams.set("branch",e):n.searchParams.delete("branch"),window.location=n}))}));