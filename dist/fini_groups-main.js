import{capitalizeFirstLetter,getQueryString}from"./helpers.js";const tbody=document.querySelector("tbody"),page=getQueryString("page"),branchVal=getQueryString("branch"),pageList=document.getElementById("page-list"),instructorSelect=document.getElementById("instructor-select"),branchSelect=document.getElementById("branchSelect");function setTable(e,t=null){tbody.innerHTML="",0==e.data.length&&(tbody.innerHTML='\n        <tr>\n          <td class="px-6 py-3.5 font-bold bg-white" colspan="9"> No Group Found </td>\n        </tr>\n    '),e.data.forEach((e=>{let t=null;t=e.has_bonus?'<i class="fa-solid fa-square-check text-green-600 mr-2"></i> <span class="text-green-600">Has Bonus':'<i class="fa-solid fa-square-xmark text-red-600 mr-2"></i> No Bonus Granted';const n=document.createElement("tr");n.className="bg-white border-b border-gray-200 hover:bg-gray-50",n.innerHTML=`\n      <th scope="row" class="px-4 py-3.5 font-medium text-gray-900 whitespace-nowrap">\n          ${e.group_name.charAt(0).toUpperCase()+e.group_name.slice(1)}\n      </th>\n      <th scope="row" class="px-4 py-3.5 font-medium text-pink-900 whitespace-nowrap">\n      <i class="fa-solid fa-clock mr-1.5"></i>\n          ${2==e.group_time||5==e.group_time?`${e.group_time} - Friday`:e.group_time}\n      </th>\n      <th scope="row" class="px-4 py-3.5 font-medium text-gray-900 whitespace-nowrap">\n      <span class="${dayBadgeColor(e.group_day)} text-sm font-medium me-2 px-2.5 py-1.5 rounded-md">${e.group_day}</span></th>\n      <td class="px-4 py-3.5">\n      <span class="w-2 h-2 ${branchIndicator(e.branch_name).bgColor} inline-block mr-2"></span>\n          ${e.instructor_name.charAt(0).toUpperCase()+e.instructor_name.slice(1)}\n      </td>\n      <td class="px-4 py-3.5 ${branchIndicator(e.branch_name).textColor}">\n        <div class="flex flex-row justify-start items-center">\n          <svg class=" w-5 h-5 mr-1.5 md:inline" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">\n              <path fill-rule="evenodd" d="M12 2c-.791 0-1.55.314-2.11.874l-.893.893a.985.985 0 0 1-.696.288H7.04A2.984 2.984 0 0 0 4.055 7.04v1.262a.986.986 0 0 1-.288.696l-.893.893a2.984 2.984 0 0 0 0 4.22l.893.893a.985.985 0 0 1 .288.696v1.262a2.984 2.984 0 0 0 2.984 2.984h1.262c.261 0 .512.104.696.288l.893.893a2.984 2.984 0 0 0 4.22 0l.893-.893a.985.985 0 0 1 .696-.288h1.262a2.984 2.984 0 0 0 2.984-2.984V15.7c0-.261.104-.512.288-.696l.893-.893a2.984 2.984 0 0 0 0-4.22l-.893-.893a.985.985 0 0 1-.288-.696V7.04a2.984 2.984 0 0 0-2.984-2.984h-1.262a.985.985 0 0 1-.696-.288l-.893-.893A2.984 2.984 0 0 0 12 2Zm3.683 7.73a1 1 0 1 0-1.414-1.413l-4.253 4.253-1.277-1.277a1 1 0 0 0-1.415 1.414l1.985 1.984a1 1 0 0 0 1.414 0l4.96-4.96Z" clip-rule="evenodd" />\n          </svg>\n          ${e.branch_name.charAt(0).toUpperCase()+e.branch_name.slice(1)}\n        </div>\n      </td> \n      <td class="px-4 py-3.5">\n          <span class="block text-rose-700">${e.month}</span>\n          ${e.formatted_date?e.formatted_date:"No date added"}\n      </td>     \n      <td class="px-4 py-3.5">\n          <span class="text-purple-700">${e.group_end_month}</span>\n          <br>\n          ${e.group_end_date}\n      </td>      \n      <td class="px-4 py-3.5">\n          ${t}\n      </td>\n  `,tbody.appendChild(n)}))}async function fetchInstructors(e){try{const t=await fetch(`functions/Instructors/get_instructors.php?branch_id=${e}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();instructorSelect.innerHTML=e?"<option value=''>Choose Instructor</option>":"<option value=''>Select Branch First</option>",n.data&&n.data.forEach((e=>{const t=document.createElement("option");t.value=e.id,t.textContent=capitalizeFirstLetter(e.username),instructorSelect.appendChild(t)}))}catch(e){console.error("Error fetching instructors:",e),instructorSelect.innerHTML="<option value=''>Error loading instructors</option>"}}function branchIndicator(e){const t={tanta:"bg-teal-600",mansoura:"bg-blue-600",zagazig:"bg-purple-500",default:"bg-orange-600"},n={tanta:"text-teal-600",mansoura:"text-blue-700",zagazig:"text-purple-700",default:"text-orange-700"};return{bgColor:t[e=e.toLowerCase()]||t.default,textColor:n[e]||n.default}}function dayBadgeColor(e){const t={saturday:"bg-orange-100 text-orange-600 border border-orange-300",sunday:"bg-blue-100 text-blue-700 border border-blue-300",monday:"bg-pink-100 text-pink-700 border border-pink-300",default:"bg-zinc-100 text-zinc-700 border border-zinc-300"};return t[e=e.toLowerCase()]||t.default}document.addEventListener("DOMContentLoaded",(function(){fetch("functions/Branches/get_branches.php").then((e=>e.json())).then((e=>{"success"==e.status&&(branchSelect.innerHTML='<option value="" selected>Select a Branch</option>',e.data.forEach((e=>{let t=document.createElement("option");t.value=e.id,t.textContent=capitalizeFirstLetter(e.name),t.value==branchVal&&(t.selected=!0),branchSelect.appendChild(t)})))})).catch((e=>console.error("Error fetching lectures:",e))),fetchInstructors(branchVal),instructorSelect.addEventListener("change",(function(e){const t=this.value;this.selectedOptions[0];let n="";n=t?`functions/Groups/get_finished_groups.php?instructor_id=${encodeURIComponent(t)}&branch_id=${branchVal}`:`functions/Groups/get_finished_groups.php?branch_id=${branchVal}`,fetch(n).then((e=>e.json())).then((e=>{setTable(e)})).catch((e=>console.error("Error:",e)))})),branchSelect.addEventListener("change",(e=>{const t=e.target.value,n=new URL(window.location);n.searchParams.delete("page"),t?n.searchParams.set("branch",t):n.searchParams.delete("branch"),window.location=n}))}));